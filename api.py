# -*- coding: utf-8 -*-
"""api

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1tcOOJjTT-CRIh5V1h7uVVaRW0IS4OYaZ
"""

# app.py

from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from pydantic import BaseModel
import numpy as np
import pickle

# Cargar el modelo
with open("modelo.pkl", "rb") as f:
    model = pickle.load(f)

# Crear la app
app = FastAPI()

# Configurar CORS
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_methods=["*"],
    allow_headers=["*"],
)

# Modelo de entrada
class PatientData(BaseModel):
    age: int
    gender: int
    educationyears: int
    glucose_min: float
    cholesterol_total: float
    EF: float
    PS: float
    Global: float

# Endpoint raíz
@app.get("/")
def home():
    return {"message": "API para predicción de demencia"}

# Endpoint de predicción
@app.post("/predict")
def predict(data: PatientData):
    features = np.array([[
        data.age,
        data.gender,
        data.educationyears,
        data.glucose_min,
        data.cholesterol_total,
        data.EF,
        data.PS,
        data.Global
    ]])
    prediction = model.predict(features)[0]
    return {"prediction": str(prediction)}

!pip freeze > requirements.txt

# Lista personalizada de paquetes para Render (solo lo esencial)
render_requirements = """
flask==2.3.3
pandas==2.2.2
numpy==1.26.4
scikit-learn==1.4.2
matplotlib==3.8.4
# agrega aquí los paquetes que SÍ usas realmente en tu app
"""

# Guardar en archivo limpio
with open("requirements_render.txt", "w") as f:
    f.write(render_requirements.strip())